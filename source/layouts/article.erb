<% wrap_layout :layout do %>
  <article itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
    <link itemprop="mainEntityOfPage" href="<%= current_page.url %>">

    <div class="container">
      <hgroup class="block p-y-md">
        <h1 class="block-title" itemprop="name headline">
          <%= current_page.data.title %>
        </h1>

        <% if subtitle = current_page.data.subtitle %>
          <p class="text-muted h4">
            <%= subtitle %>
          </p>
        <% end %>
      </hgroup>

      <div class="row">
        <div class="col-lg-8 article-body text-justify" itemprop="articleBody text">
          <%= yield %>

          <hr>

          <p class="text-muted">
            <% if (canonical_source = current_page.data.canonical_source) %>
              This article was originally published on <%= canonical_source[:name] %>:
              <%= link_to current_page.data.title, canonical_source[:url] %>.

              <% if (related = current_page.data.related) %>
                It has also appeared on
                <%= related.map { |source| link_to source[:name], source[:url] }.to_sentence %>.
              <% end %>
            <% elsif (related = current_page.data.related) %>
              This article has also appeared on
              <%= related.map { |source| link_to source[:name], source[:url] }.to_sentence %>.
            <% end %>
          </p>

        </div>

        <div class="col-lg-4">
          <div id="sidebar" class="text-right hidden-print hidden-xs hidden-sm hidden-md" data-spy="affix" data-offset-top="350">
            <div class="panel">
              <hgroup class="panel-heading">
                <h3 class="panel-title">
                  About this article
                </h3>
              </hgroup>

              <table class="table table-striped">
                <caption class="sr-only">Article metadata</caption>
                <thead class="sr-only">
                  <tr>
                    <th>Attribute</th>
                    <th>Value</th>
                  </tr>
                </thead>

                <tbody>
                  <tr>
                    <th scope="row" style="width: 40%">
                      Author
                    </th>
                    <td>
                      <span itemprop="author creator" itemscope itemtype="http://schema.org/Person">
                        <% link_to '/team/mathie.html', itemprop: 'url' do %>
                          <span itemprop="name">
                            <span itemprop="givenName">
                              Graeme
                            </span>
                            <span itemprop="familyName">
                              Mathieson
                            </span>
                          </span>
                        </span>
                      <% end %>
                    </td>
                  </tr>

                  <tr>
                    <th scope="row">
                      Publisher
                    </th>
                    <td>
                      <span itemprop="copyrightHolder publisher" itemscope itemtype="http://schema.org/Organization">
                        <span class="hidden" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
                          <img itemprop="contentUrl url" src="<%= image_path config[:logo] %>" alt="">
                        </span>
                        <% link_to '/', itemprop: 'url' do %>
                          <span itemprop="name">
                            Wossname Industries
                          </span>
                        <% end %>
                      </span>
                    </td>
                  </tr>

                  <% if (canonical_source = current_page.data.canonical_source) %>
                    <tr>
                      <th scope="row">
                        Originally published on
                      </th>

                      <td>
                        <%= link_to canonical_source[:name], canonical_source[:url], target: '_blank' %>
                      </td>
                    </tr>
                  <% end %>

                  <% if (related = current_page.data.related) %>
                    <tr>
                      <th scope="row">
                        Also appears on
                      </th>

                      <td>
                        <% related.each do |source| %>
                          <%= link_to source[:name], source[:url], target: '_blank' %> <br>
                        <% end %>
                      </td>
                    </tr>
                  <% end %>

                  <tr>
                    <th scope="row">
                      First published
                    </th>
                    <td itemprop="dateCreated datePublished">
                      <%= published_on_tag %>
                    </td>
                  </tr>

                  <tr>
                    <th scope="row">
                      Last updated
                    </th>
                    <td itemprop="dateModified">
                      <%= updated_on_tag %>
                    </td>
                  </tr>

                  <tr>
                    <th scope="row">
                      Category
                    </th>
                    <td itemprop="articleSection">
                      <%= link_to_category category_meta, class: 'label label-info' %>
                    </td>
                  </tr>

                  <tr>
                    <th scope="row">
                      Tags
                    </th>
                    <td>
                      <%= tags_meta.map { |tag| link_to_tag tag, class: 'label label-warning' }.join(' ') %>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>

            <% if (contents = current_page.data.contents) %>
              <nav id="sidebar-contents" class="panel">
                <hgroup class="panel-heading">
                  <h3 class="panel-title">
                    Table of Contents
                  </h3>
                </hgroup>

                <ul class="nav nav-bordered nav-stacked">
                  <% contents.each do |title| %>
                    <li role="presentation">
                      <%= link_to title, '', fragment: parameterize(title), class: 'p-y-0' %>
                    </li>
                  <% end %>
                </nav>
              <% end %>
            </div>
        </div>
      </div>
    </div>
  </article>
<% end %>
